<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Platformer Game</title>
<style>
    body {
        margin: 0;
        background: #222;
        overflow: hidden;
        font-family: sans-serif;
    }
    #gameContainer {
        position: relative;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
    }
    canvas {
        display: block;
        background: #333;
    }
    #start-message {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 24px;
        color: white;
        background: rgba(0, 0, 0, 0.5);
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        z-index: 5;
        pointer-events: none; /* Let clicks pass through */
    }
    #touch-controls {
        display: none;
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        justify-content: space-between;
        z-index: 10;
    }
    .touch-btn {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        text-align: center;
        line-height: 60px;
        font-size: 24px;
        user-select: none;
    }
    #touch-controls-toggle {
        position: absolute;
        top: 10px;
        right: 10px;
        z-index: 11;
        display: none;
        background: rgba(255,255,255,0.2);
        padding: 8px;
        border-radius: 5px;
    }
    @media (max-width: 768px) and (pointer: coarse) {
        #touch-controls-toggle { display: block !important; }
    }
</style>
</head>
<body>

<div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="450"></canvas>
    <div id="start-message">Click or tap anywhere to start</div>

    <div id="touch-controls-toggle">ðŸŽ®</div>
    <div id="touch-controls">
        <div id="touch-left" class="touch-btn">â¬…</div>
        <div id="touch-right" class="touch-btn">âž¡</div>
        <div id="touch-up" class="touch-btn">â¬†</div>
        <div id="touch-shoot" class="touch-btn">ðŸ”«</div>
    </div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const gameContainer = document.getElementById('gameContainer');

let gameRunning = false;
const keys = {};

// Start game function
function startGame() {
    gameRunning = true;
    document.getElementById('start-message').style.display = 'none';
    console.log("Game started!");
    // You can place your reset/init game logic here
}

// Listen for pointerdown (works for mouse + touch)
gameContainer.addEventListener('pointerdown', (e) => {
    if (!gameRunning) {
        startGame();
    }
});

// Input helper
function setKey(key, isPressed) {
    keys[key] = isPressed;
}

// Keyboard controls
window.addEventListener('keydown', (e) => {
    setKey(e.code, true);
});
window.addEventListener('keyup', (e) => {
    setKey(e.code, false);
});

// Touch button binding
function bindTouchButton(id, keyName) {
    const btn = document.getElementById(id);
    if (!btn) return;
    btn.addEventListener('touchstart', (e) => {
        e.preventDefault();
        setKey(keyName, true);
    }, { passive: false });
    btn.addEventListener('touchend', (e) => {
        e.preventDefault();
        setKey(keyName, false);
    }, { passive: false });
}

bindTouchButton('touch-left', 'ArrowLeft');
bindTouchButton('touch-right', 'ArrowRight');
bindTouchButton('touch-up', 'Space');
bindTouchButton('touch-shoot', 'KeyZ');

// Swipe / tap gestures
let touchStartX = 0, touchStartY = 0, touchStartTime = 0;
gameContainer.addEventListener('touchstart', (e) => {
    if (e.target.closest('#touch-controls')) return;
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
    touchStartTime = Date.now();
}, { passive: true });

gameContainer.addEventListener('touchend', (e) => {
    if (e.target.closest('#touch-controls')) return;
    const dx = e.changedTouches[0].screenX - touchStartX;
    const dy = e.changedTouches[0].screenY - touchStartY;
    const dt = Date.now() - touchStartTime;
    const swipeThreshold = 30;

    if (Math.abs(dx) > Math.abs(dy) && Math.abs(dx) > swipeThreshold) {
        if (dx > 0) {
            setKey('ArrowRight', true);
            setTimeout(() => setKey('ArrowRight', false), 100);
        } else {
            setKey('ArrowLeft', true);
            setTimeout(() => setKey('ArrowLeft', false), 100);
        }
    }
    else if (dy < -swipeThreshold) {
        setKey('Space', true);
        setTimeout(() => setKey('Space', false), 100);
    }
    else if (dt < 200) {
        setKey('KeyZ', true);
        setTimeout(() => setKey('KeyZ', false), 100);
    }
}, { passive: true });

// Toggle controls
const touchControlsToggle = document.getElementById('touch-controls-toggle');
const touchControls = document.getElementById('touch-controls');
touchControlsToggle.addEventListener('click', () => {
    const isVisible = touchControls.style.display === 'flex';
    touchControls.style.display = isVisible ? 'none' : 'flex';
});

// Game loop (dummy for now)
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    if (!gameRunning) {
        requestAnimationFrame(gameLoop);
        return;
    }

    // Example: Draw player if running
    ctx.fillStyle = "lime";
    ctx.fillRect(100, 100, 50, 50);

    requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
