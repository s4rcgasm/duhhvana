<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Duhhvana</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* --- Basic Setup --- */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            overflow: hidden;
            background-color: #1a1a2e;
            color: #e0e0e0;
            font-family: 'Press Start 2P', cursive;
        }
        body {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
            box-sizing: border-box;
        }

        .game-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            max-width: 1100px; /* Max width for game + UI */
            gap: 20px;
        }

        /* --- Game Container (Scales with Aspect Ratio) --- */
        #game-container {
            position: relative;
            width: 100%;
            flex-shrink: 1;
            min-width: 0; /* Fix for flexbox sizing */
            aspect-ratio: 800 / 600;
            border: 4px solid #0f3460;
            box-shadow: 0 0 20px #0f3460, inset 0 0 15px rgba(15, 52, 96, 0.7);
            background-color: #000;
        }

        canvas {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: block;
            background: #0d1117;
            image-rendering: pixelated;
        }
        
        /* --- UI Panel (Hidden by default) --- */
        #ui-panel {
            display: none; /* Hidden on mobile */
            text-align: left;
            width: 250px;
            flex-shrink: 0;
        }

        #game-container.shake { animation: shake 0.4s; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        #branding { font-size: 1.2rem; color: #fff; text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 0px #e94560; }
        #score-display, #leaderboard h2 { color: #e94560; font-size: 1.2rem; margin-bottom: 10px; }
        #leaderboard { margin-top: 20px; }
        #high-scores-list { list-style-type: none; padding: 0; font-size: 0.8rem; height: 150px; overflow-y: auto; }
        #high-scores-list li { padding: 4px 0; border-bottom: 1px dashed #0f3460; }
        
        .game-overlay {
            position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            display: flex; align-items: center; justify-content: center; text-align: center;
            background-color: rgba(26, 26, 46, 0.95);
            z-index: 100; padding: 20px; box-sizing: border-box;
        }
        #loading-screen { z-index: 101; cursor: pointer; }
        .overlay-content { max-width: 90%; }
        .overlay-content h2 { color: #e94560; font-size: 1.5rem; margin-bottom: 20px; }
        .ethos-text { font-size: 1rem; line-height: 1.6; margin-bottom: 40px; }
        .start-text { font-size: 1.2rem; color: #fff; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #message-modal, #duhhvana-reward-modal { display: none; }
        #high-score-form, #win-high-score-form { margin-top: 15px; }
        #player-name-input, #win-player-name-input { font-family: 'Press Start 2P', cursive; background-color: #1a1a2e; color: #fff; border: 2px solid #0f3460; padding: 10px; font-size: 1rem; width: 70%; text-align: center; }
        #high-score-form button, #win-high-score-form button { margin-top: 10px; }
        .modal-buttons button { font-family: 'Press Start 2P', cursive; font-size: 1rem; padding: 15px 25px; background-color: #e94560; color: #fff; border: 2px solid #fff; cursor: pointer; margin: 5px; }
        
        /* --- Touch Controls --- */
        #touch-controls {
            position: fixed; bottom: 10px; left: 0; width: 100%;
            padding: 0 20px; box-sizing: border-box; 
            display: none; /* Hidden by default, enabled for touch devices */
            justify-content: space-between; align-items: flex-end;
            user-select: none; z-index: 102;
            pointer-events: none;
        }
        #touch-controls .touch-button, #controls-toggle button {
            pointer-events: auto;
        }
        .touch-dpad { display: flex; gap: 15px; }
        .touch-button { width: 55px; height: 55px; background-color: rgba(255, 255, 255, 0.15); border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; }
        #touch-shoot { width: 70px; height: 70px; }
        
        #controls-toggle { position: absolute; top: 0px; right: 0px; }
        #controls-toggle button { font-family: 'Press Start 2P', cursive; font-size: 0.6rem; padding: 8px; background-color: rgba(15, 52, 96, 0.7); color: #fff; border: 1px solid #fff; cursor: pointer; }

        /* --- Media Queries --- */

        /* DESKTOP LAYOUT */
        @media (min-width: 1000px) {
            #ui-panel { display: block; }
        }

        /* TOUCH DEVICE LAYOUT */
        @media (pointer: coarse) {
            #touch-controls { display: flex; }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div id="game-container">
            <div id="loading-screen" class="game-overlay">
                <div class="overlay-content">
                    <h2>A Sarcgasm.com Production</h2>
                    <p class="ethos-text">In a world saturated with information, true bliss is found in the cramped cocoon of curated ignorance. Your mission is to violently reject objective reality and build your own echo chamber, one comforting lie at a time. Prepare for... DUHHVANA.</p>
                    <p class="start-text" id="loading-status">Click or Tap anywhere to begin...</p>
                </div>
            </div>
            <canvas id="gameCanvas"></canvas>
            <div id="message-modal" class="game-overlay">
                <div class="overlay-content">
                    <h2 id="message-title"></h2>
                    <p id="message-text"></p>
                    <div id="high-score-form" style="display: none;">
                        <p>You made the leaderboard! Enter your name:</p>
                        <input type="text" id="player-name-input" maxlength="10" placeholder="Player">
                        <button id="submit-score-button">Submit</button>
                    </div>
                    <div class="modal-buttons">
                        <button id="restart-button">Play Again</button>
                        <button id="share-button">Share</button>
                    </div>
                </div>
            </div>
            <div id="duhhvana-reward-modal" class="game-overlay">
                <div class="overlay-content">
                    <h2>You Have Achieved DUHHVANA!</h2>
                    <p>True bliss is yours. As a reward for your dedication to ignorance, claim what is rightfully yours.</p>
                    <div id="win-high-score-form" style="display: none;">
                        <p>You made the leaderboard! Enter your name:</p>
                        <input type="text" id="win-player-name-input" maxlength="10" placeholder="Player">
                        <button id="win-submit-score-button">Submit Score</button>
                    </div>
                    <div class="modal-buttons">
                        <button id="claim-reward-button">CLAIM YOUR REWARD</button>
                        <button id="restart-button-win">Play Again</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="ui-panel">
            <div id="branding">sarcgasm.com</div>
            <div id="score-display">SCORE: 0</div>
            <div id="leaderboard"><h2>Leaderboard</h2><ol id="high-scores-list"></ol></div>
        </div>
    </div>
    <div id="touch-controls">
        <div class="touch-dpad">
            <div class="touch-button" id="touch-left">‹</div>
            <div class="touch-button" id="touch-right">›</div>
        </div>
        <div id="controls
