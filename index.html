<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Duhhvana</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <!-- Sound Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <style>
        /* --- Basic Setup & Retro Feel --- */
        html, body {
            height: 100%;
            margin: 0;
            overflow: hidden;
        }
        body {
            background-color: #1a1a2e;
            color: #e0e0e0;
            font-family: 'Press Start 2P', cursive;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            box-sizing: border-box;
            position: relative; 
        }

        .game-wrapper {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            width: 100%;
            height: 100%;
            padding: 1rem;
            box-sizing: border-box;
        }

        /* --- Game Container --- */
        #game-container {
            border: 4px solid #0f3460;
            box-shadow: 0 0 20px #0f3460, inset 0 0 15px rgba(15, 52, 96, 0.7);
            background-color: #000;
            position: relative;
            /* NEW: Let the container be flexible */
            width: 80%;
            max-width: 800px;
            aspect-ratio: 4 / 3;
            touch-action: none;
        }

        #game-container.shake { animation: shake 0.4s; }
        @keyframes shake {
          10%, 90% { transform: translate3d(-1px, 0, 0); }
          20%, 80% { transform: translate3d(2px, 0, 0); }
          30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
          40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        canvas {
            display: block;
            background: #0d1117;
            image-rendering: pixelated;
            position: absolute;
            top: 0; left: 0;
            width: 100%; /* NEW: Canvas fills container */
            height: 100%;
        }

        #ui-panel { text-align: left; width: 250px; flex-shrink: 0; padding-left: 20px; }
        #branding { font-size: 1.2rem; color: #fff; text-align: center; margin-bottom: 20px; text-shadow: 2px 2px 0px #e94560; }
        #score-display, #leaderboard h2 { color: #e94560; font-size: 1.2rem; margin-bottom: 10px; }
        #leaderboard { margin-top: 20px; }
        #high-scores-list { list-style-type: none; padding: 0; font-size: 0.8rem; height: 150px; overflow-y: auto; }
        #high-scores-list li { padding: 4px 0; border-bottom: 1px dashed #0f3460; }
        
        /* --- Overlays (Loading/Modals) --- */
        .game-overlay {
            position: absolute; 
            top: 0; left: 0; right: 0; bottom: 0;
            display: flex;
            align-items: center; justify-content: center; text-align: center;
            background-color: rgba(26, 26, 46, 0.95);
            z-index: 100;
            padding: 20px;
            box-sizing: border-box;
        }
        #loading-screen { z-index: 101; cursor: pointer; }
        .overlay-content { max-width: 90%; }
        .overlay-content h2 { color: #e94560; font-size: 1.5rem; margin-bottom: 20px; }
        .ethos-text { font-size: 1rem; line-height: 1.6; margin-bottom: 40px; }
        .start-text { font-size: 1.2rem; color: #fff; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        #message-modal, #duhhvana-reward-modal { display: none; }
        #high-score-form, #win-high-score-form { margin-top: 15px; }
        #player-name-input, #win-player-name-input { font-family: 'Press Start 2P', cursive; background-color: #1a1a2e; color: #fff; border: 2px solid #0f3460; padding: 10px; font-size: 1rem; width: 70%; text-align: center; }
        #high-score-form button, #win-high-score-form button { margin-top: 10px; }
        .modal-buttons button { font-family: 'Press Start 2P', cursive; font-size: 1rem; padding: 15px 25px; background-color: #e94560; color: #fff; border: 2px solid #fff; cursor: pointer; transition: background-color 0.2s, color 0.2s; margin: 5px; }
        
        #touch-controls {
            position: fixed; bottom: 0; left: 0; width: 100%;
            padding: 20px; box-sizing: border-box; display: none;
            justify-content: space-between; align-items: flex-end;
            user-select: none; z-index: 102;
        }
        .touch-dpad { display: flex; gap: 10px; }
        .touch-button { width: 60px; height: 60px; background-color: rgba(255, 255, 255, 0.2); border: 2px solid rgba(255, 255, 255, 0.4); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; font-family: sans-serif; }
        #touch-shoot { width: 80px; height: 80px; }
        
        @media (max-width: 1100px) {
            .game-wrapper { flex-direction: column; align-items: center; }
            #ui-panel { width: 100%; max-width: 400px; margin-top: 20px; text-align: center; padding-left: 0; }
        }
        @media (max-width: 768px) and (pointer: coarse) {
            #touch-controls { display: flex; }
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div id="game-container">
            <div id="loading-screen" class="game-overlay">
                <div class="overlay-content">
                    <h2>A Sarcgasm.com Production</h2>
                    <p class="ethos-text">In a world saturated with information, true bliss is found in the cramped cocoon of curated ignorance. Your mission is to violently reject objective reality and build your own echo chamber, one comforting lie at a time. Prepare for... DUHHVANA.</p>
                    <p class="start-text" id="loading-status">Click or Tap anywhere to begin...</p>
                </div>
            </div>
            <canvas id="gameCanvas"></canvas>
            <div id="message-modal" class="game-overlay"> ... </div>
            <div id="duhhvana-reward-modal" class="game-overlay"> ... </div>
        </div>
        <div id="ui-panel">
            <div id="branding">sarcgasm.com</div>
            <div id="score-display">SCORE: 0</div>
            <div id="leaderboard"><h2>Leaderboard</h2><ol id="high-scores-list"></ol></div>
        </div>
    </div>
    <div id="touch-controls"> ... </div>
    <script>
        window.onload = function() {
            const gameContainer = document.getElementById('game-container');
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            
            // --- NEW: Internal resolution is now separate from display size ---
            const INTERNAL_WIDTH = 800;
            const INTERNAL_HEIGHT = 600;
            canvas.width = INTERNAL_WIDTH;
            canvas.height = INTERNAL_HEIGHT;

            // --- Simplified resize logic ---
            function resizeGame() {
                const gameArea = document.querySelector('.game-wrapper');
                const containerRect = gameArea.getBoundingClientRect();
                const aspectRatio = INTERNAL_WIDTH / INTERNAL_HEIGHT;

                let newWidth = containerRect.width;
                let newHeight = newWidth / aspectRatio;

                if (newHeight > window.innerHeight) {
                    newHeight = window.innerHeight * 0.9; // Use 90% of viewport height
                    newWidth = newHeight * aspectRatio;
                }

                gameContainer.style.width = `${newWidth}px`;
                gameContainer.style.height = `${newHeight}px`;
            }
            resizeGame();
            window.addEventListener('resize', resizeGame);

            // Rest of JS code
            const GRAVITY = 0.5, PLAYER_SPEED = 5, JUMP_FORCE = -12, PROJECTILE_SPEED = 10, OBJECT_SPAWN_RATE = 120, MAX_HIGH_SCORES = 5;
            const truthsList = [ "PUTIN RIDES HORSES BARE-CHESTED", "WATER IS WET", "EARTH IS (MOSTLY) ROUND", "GRAVITY PULLS YOU DOWN", "THE SUN IS A STAR", "DOGS BARK", "FIRE IS HOT", "ICE IS COLD", "SPIDERS HAVE 8 LEGS", "TREES PRODUCE OXYGEN", "TRUTH IS A PROCESS", "THE GREAT WALL IS IN CHINA", "BEWARE CONFIRMATION BIAS", "THE UNIVERSE IS BIG", "CLMATE CHANGE IS REAL", "THIS GAME IS FUNNY AF" ];
            const liesList = [ "THE EARTH IS FLAT", "VACCINES CAUSE AUTISM", "ALTERNATIVE FACTS ARE VALID", "ELON MUSK IS NOT A NAZI", "JEFF BEZOS IS HANDSOME", "THE MOON LANDING WAS FAKE", "BIRDS AREN'T REAL", "CHOCOLATE IS A VEGETABLE", "TRICKLE-DOWN ECONOMICS WORKS", "5G TOWERS SPREAD VIRUSES", "DIET SODA IS HEALTHY", "READING TERMS AND CONDITIONS", "I'LL START MY DIET TOMORROW", "I AM ALWAYS RIGHT", "THIS IS THE FINAL DRAFT", "I READ THE TERMS OF SERVICE" ];
            const blockColors = ['#B22234', '#FFFFFF', '#3C3B6E'];
            let keys = {}, projectiles = [], fallingObjects = [], platforms = [], frameCount = 0, gameOver = false, gameWon = false, score = 0, audioStarted = false;

            const soundFiles = {
                fire: 'sounds/trump_fakenewsmedia.mp3',
                jump: 'sounds/trump_jumpingnoise_mockingtrans.mp3',
                grunt: 'sounds/trump_cantdoit.mp3',
                truthLand: 'sounds/trump_grabembythepussy.mp3',
                lieLand: 'sounds/trump_youcandoanything.mp3',
                truthShot: 'sounds/trump_radicallunatics.mp3',
                lieShot: 'sounds/trump_disrespectful.mp3',
                gameOver: 'sounds/trump_wordwarthree.mp3',
                duhhvana: 'sounds/trump_didIsaythatIcantbelieve.mp3'
            };

            const fallbackSounds = { /* ... same as before ... */ };
            const players = new Tone.Players(soundFiles, { onload: () => console.log('Custom sounds loaded!'), onerror: (error) => console.error("A sound failed", error), }).toDestination();
            players.crossOrigin = "anonymous";
            function playSound(soundName) { /* ... same as before ... */ }
            const player = { /* ... same as before ... */ };
            // ... all other functions are identical
        };
    </script>
</body>
</html>
